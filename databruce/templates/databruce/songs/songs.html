{% extends "databruce/category.html" %}
{% block title %}
  Songs
{% endblock title %}
{% block info_row %}
  <div class="text-2xl">Songs</div>
  <div class="text-base">Songs that Bruce has played live</div>
{% endblock info_row %}
{% block table_id %}
  songsTable
{% endblock table_id %}
{% block table %}
  <thead>
    <tr class="custom">
      <th class="all" scope="col">Name</th>
      <th class="min-tablet-l" scope="col">
        <i class="bi bi-file-earmark-check d-none d-lg-block"
           data-bs-toggle="tooltip"
           data-bs-placement="top"
           data-bs-title="Has Lyrics"></i>
        <span class="d-inline d-lg-none">Has Lyrics:</span>
      </th>
      <th class="min-tablet-l" scope="col">Original Artist</th>
      <th class="min-tablet-l" scope="col">Category</th>
      <th class="min-tablet-l" scope="col">First</th>
      <th class="min-tablet-l" scope="col">Last</th>
      <th class="min-tablet-l text-center" scope="col">Public</th>
      <th class="min-tablet-l text-center" scope="col">Private</th>
      <th class="min-tablet-l text-center" scope="col">Snippet</th>
    </tr>
  </thead>
  {% comment %} <tbody>
    {% for song in songs %}
      <tr>
        <td class="text-nowrap">
          <a href="{% url 'song_details' id=song.id %}">{{ song.name }}</a>
        </td>
        <td class="icon text-center align-middle">
          {% if song.lyrics %}
            <i class="bi bi-file-earmark-check d-none d-lg-block" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Has Lyrics"></i>
            <div class="d-inline d-lg-none">True</div>
          {% else %}
            <div class="d-inline d-lg-none">False</div>
          {% endif %}
        </td>
        <td class="text-nowrap">{{ song.original_artist }}</td>
        <td class="text-wrap">{{ song.category }}</td>
        <td class="text-nowrap" data-sort="{{ song.first.get_date }}" data-filter="{{ song.first.get_date }}">
          {% if song.first %}
            <a href="{% url "event_details" id=song.first.id %}">{{ song.first.get_date }}</a>
          {% endif %}
        </td>
        <td class="text-nowrap" data-sort="{{ song.last.get_date }}" data-filter="{{ song.last.get_date }}">
          {% if song.last %}
            <a href="{% url "event_details" id=song.last.id %}">{{ song.last.get_date }}</a>
          {% endif %}
        </td>
        <td class="text-center">{{ song.num_plays_public }}</td>
        <td class="text-center">{{ song.num_plays_private }}</td>
        <td class="text-center">{{ song.num_plays_snippet }}</td>
      </tr>
    {% endfor %}
  </tbody> {% endcomment %}
{% endblock table %}
{% block scripts %}
  <script>
  $(document).ready(function () {
    var layout = getDatatableLayout([1,2,3,4,5,6,7,8], true);
    dtCategorySelect(layout, 3, [{'label': 'All', 'value': '.*'}, {'label': 'Originals', 'value': 'Originals'}, {'label': 'Covers', 'value': 'Covers'}])

    new DataTable('#songsTable', {
      layout: layout,
      columnDefs: [
        { "defaultContent": "", "type": 'text', "targets": '_all' },
        { type: 'date', targets: [4, 5] },
        { targets: [6,7,8], width: "1rem", className: 'text-center' },
        { targets: [1], orderable: false },
      ],
      serverSide: true,
      processing: true,
      ajax: {
        'url': '/api/v1/songs/?format=datatables&keep=id',
      },
      columns: [
        {
          'data': 'name',
          'name': 'name',
          'render': function (data, type, row, meta) {
              if (type === 'display') {
                return '<a href="/songs/' + row.id + '">'+ data +'</a>';
              } else if (type == 'filter') {
                return 'date';
              };
          },
        },
        {
          'data': 'lyrics',
          'name': 'lyrics',
          'render': function (data, type, row, meta) {
              if (type === 'display') {
                return row.lyrics ? '<i class="bi bi-file-earmark-check d-none d-md-block" data-bs-toggle="tooltip" data-bs-placement="top" data-bs-title="Has Lyrics"></i><div class="d-inline d-md-none">True</div>' : '<div class="d-inline d-md-none">False</div>'
              } else if (type === 'filter') {
                return 'lyrics';
              };
          },          
        },
        {'data': 'original_artist', 'name': 'original_artist'},
        {'data': 'category', 'name': 'category'},
        {
          'data': 'first',
          'name': 'first__date',
          'render': function (data, type, row, meta) {
              if (type === 'display') {
                if (data) {
                  return '<a href="/events/' + data.id + '">'+ data.date +'</a>';
                }
                return null
              } else if (type == 'filter') {
                return 'first__date';
              };
          },
        },
        {
          'data': 'last',
          'name': 'last__date',
          'render': function (data, type, row, meta) {
              if (type === 'display') {
                if (data) {
                  return '<a href="/events/' + data.id + '">'+ data.date +'</a>';
                }
                return null
              } else if (type == 'filter') {
                return 'last__date';
              };
          },        
        },
        {'data': 'num_plays_public', 'name': 'num_plays_public'},
        {'data': 'num_plays_private', 'name': 'num_plays_private'},
        {'data': 'num_plays_snippet', 'name': 'num_plays_snippet'},
      ]
    });
  });
  </script>
{% endblock scripts %}

{% extends "databruce/base.html" %}'
{% load filters %}
{% block title %}
  Songs
{% endblock title %}
{% block content %}
  <h4>Songs</h4>
  <h6>Songs that Bruce has played live</h6>
  <div class="table-responsive">
    <table class="table table display nowrap" id="songsTable">
      <thead>
        <tr>
          <th>Name</th>
          <th>First</th>
          <th>Last</th>
          <th>Opener</th>
          <th>Closer</th>
          <th>Public</th>
          <th>Private</th>
          <th>Snippet</th>
          <th>Original Artist</th>
          <th>Original?</th>
        </tr>
      </thead>
      <tbody>
        {% for song in songs %}
          <tr>
            <td>
              <a href="{% url 'databruce:song_details' id=song.id %}">{{ song.song_name }}</a>
            </td>
            <td>
              {% if song.first %}
                <a href="{% url 'databruce:event_details' event=song.first.id %}">{{ song.first.event_date|get_date:song.first.id }} {{ song.first.early_late|default_if_none:"" }}</a>
              {% endif %}
            </td>
            <td>
              {% if song.last %}
                <a href="{% url 'databruce:event_details' event=song.last.id %}">{{ song.last.event_date|get_date:song.last.id }} {{ song.last.early_late|default_if_none:"" }}</a>
              {% endif %}
            </td>
            <td>{{ song.opener }}</td>
            <td>{{ song.closer }}</td>
            <td>{{ song.num_plays_public }}</td>
            <td>{{ song.num_plays_private }}</td>
            <td>{{ song.num_plays_snippet }}</td>
            <td>{{ song.original_artist }}</td>
            <td>
              {% if song.original_artist == 'Bruce Springsteen' %}
                Original
              {% else %}
                Cover
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% load static %}
  <script src="{% static 'databruce/js/datatables.js' %}"></script>
  <script src="{% static 'databruce/js/searchBuilder.js' %}"></script>
  <script>
    layout.topEnd.features[1].buttons[1].config.columns = [3, 4, 5, 6, 7, 8, 9]

    $(document).ready(function () {
      $('#songsTable').dataTable({
        layout: layout,
        columnDefs: [
          {
            target: -1,
            visible: false
          }
        ],
        initComplete: function () {
          this.api()
            .columns([-1])
            .every(function () {
                var column = this;

                $('<div class="row g-3 align-items-center"><div class="col-auto"><label for="artist">Category:</label></div><div class="col" id="artist-select"></div></div>').appendTo($('#dropdown-container'));
  
                // this appears to be the only way to add a select filter
                // without going through ajax calls. I originally had a pre-made dropdown in
                // another file and included it like above, however, I had to use an ajax call
                // otherwise it would appear but not work
                var select = $('<select id="artist" class="custom-select form-select form-select-sm"></select>')
                  .appendTo($('#artist-select'))
                  .on('change', function () {
                      column
                        .search($(this).val(), {regex: true})
                        .draw();
                  });
                
                
                select.append('<option value=".*">All</option>');
                select.append('<option value="Original">Originals</option>');
                select.append('<option value="Cover">Covers</option>');
            });
        },
      });
     });
  </script>
{% endblock content %}

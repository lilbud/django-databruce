{% extends "databruce/base.html" %}
{% load static %}
{% block title %}
  Test
{% endblock title %}
{% block extrajs %}
  <link href="https://cdn.datatables.net/columncontrol/1.0.7/css/columnControl.dataTables.min.css"
        rel="stylesheet">
  <script src="https://cdn.datatables.net/columncontrol/1.0.7/js/dataTables.columnControl.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/htmx.org@2.0.7/dist/htmx.min.js"></script>
{% endblock extrajs %}
{% block content %}
  <div class="text-2xl">Songs</div>
  <div class="table-responsive">
    <table id="myTable" width="100%" class="table table-hover display">
      <thead>
        <tr>
          <th class="all" scope="col">Date</th>
          <th class="all" scope="col">Act</th>
          <th class="min-tablet-l" scope="col">Venue</th>
          <th class="min-tablet-l" scope="col">Tour</th>
          <th class="min-tablet-l" scope="col">Position</th>
          <th class="min-tablet-l" scope="col">Gap</th>
          <th class="min-tablet-l" scope="col">Prev</th>
          <th class="min-tablet-l" scope="col">Next</th>
          <th class="min-tablet-l text-nowrap" scope="col">Note</th>
        </tr>
      </thead>
    </table>
  </div>
  <script>
    $(document).ready(function() {
      var table = $('#myTable').DataTable(
        {
          layout: getDatatableLayout([1,2,3,4,5,6,7,8]),
          serverSide: true,
          ajax: {
            'url': '/api/v1/songspage/?id=164&format=datatables',
          },
          columns: [
            {'data': 'event.date', 'name': 'event.date'},
            {'data': 'artist_name', 'name': 'artist'},
            {'data': 'venue_name'},
            {'data': 'tour_name'},
            {'data': 'position'},
            {'data': 'gap'},
            {'data': 'prev'},
            {'data': 'next'},
            {'data': 'note'},
          ],
          "initComplete": function( settings, json ) {
              htmx.process('#myTable');
          },
        }
      );
    });

    document.body.addEventListener('htmx:afterRequest', function(evt) {
        table.ajax.reload(function() {
            htmx.process('#myTable');
        }, false)
    });
  </script>
{% endblock content %}

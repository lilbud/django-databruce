{% extends "databruce/base.html" %}
{% load static %}
{% block title %}
  Test
{% endblock title %}
{% block content %}
  <h4>Songs</h4>
  <div class="table-responsive">
    <table id="myTable"
           width="100%"
           class="table table-striped table-bordered dt-responsive compact nowrap">
      <thead>
        <tr>
          <th>Name</th>
          <th>Category</th>
          <th>First</th>
          <th>Last</th>
          <th>Public</th>
          <th>Private</th>
          <th>Snippet</th>
          <th>Original Artist</th>
          <th>Original?</th>
        </tr>
      </thead>
    </table>
  </div>
  <script>
    $(document).ready(function() {
      var table = $('#myTable').DataTable(
        {
          layout: layout,
          serverSide: true,
          processing: true,
          columnDefs: [
          {
            target: -1,
            visible: false
          }],
          ajax: {
            'url': '/api/v1/songs/?format=datatables',
          },
          columns: [
              {'data': 'name'},
              {'data': 'category'},
              {'data': 'first.date', 'name': 'first.id'},
              {'data': 'last.date', 'name': 'last.id'},
              {'data': 'num_plays_public'},
              {'data': 'num_plays_private'},
              {'data': 'num_plays_snippet'},
              {'data': 'original_artist'},
              {'data': 'original'},
          ],
        }
      );

      var d = table.searchBuilder.getDetails();
      console.log(d);
      
      $('<div class="row g-3 align-items-center"><div class="col-auto"><label for="artist">Category:</label></div><div class="col" id="artist-select"></div></div>').appendTo($('#dropdown-container'));

      var select = $('<select id="artist" class="custom-select form-select form-select-sm"></select>').appendTo($('#artist-select'))

      select.append('<option value="^.*$">All</option>');
      select.append('<option value="^True$">Originals</option>');
      select.append('<option value="^False$">Covers</option>');

      $('#artist').on('change', function() {    
        table.columns(-1).search(this.value, { regex: true }).draw();
      });

      
    });
  </script>
{% endblock content %}

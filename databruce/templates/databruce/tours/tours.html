{% extends "databruce/category.html" %}
{% block title %}
  Tours
{% endblock title %}
{% block info_row %}
  <div class="text-2xl">Tours</div>
{% endblock info_row %}
{% block table_id %}
  tourTable
{% endblock table_id %}
{% block table %}
  <thead>
    <tr class="header">
      <th class="all" scope="col">Name</th>
      <th class="all" scope="col">Band</th>
      <th class="min-tablet-l" scope="col">First</th>
      <th class="min-tablet-l" scope="col">Last</th>
      <th scope="col" class="text-center min-tablet-l">Shows</th>
      <th scope="col" class="text-center min-tablet-l">Songs</th>
      <th scope="col" class="text-center min-tablet-l">Legs</th>
    </tr>
  </thead>
{% endblock table %}
{% block scripts %}
  <script>
  $(document).ready(function () {
    new DataTable('#tourTable', {
      layout: getDatatableLayout({columns: [1, 2, 3, 4, 5, 6]}),
      serverSide: true,
      processing: true,
      scrollY: '60vh',
      scrollCollapse: true,
      ajax: {
        'url': '/api/v1/tours/?format=datatables&keep=id',
      },
      columnDefs: [
        { "defaultContent": "", "type": 'text', "targets": '_all' },
        { targets: [4, 5, 6], width: '6rem', className: 'dt-center' },
        { targets: [2, 3], width: '8rem', className: 'dt-left' },
        { targets: [1], width: '12rem', className: 'dt-left' },
      ],
      columns: [
        {
          'data': 'name',
          'name': 'name',
          'width': '10rem',
          'render': function (data, type, row, meta) {
            if (type === 'display') {
              return '<a href="/tours/' + row.id + '">'+ row.name +'</a>';
            } else if (type == 'filter') {
              return 'name';
            };
          },
        },
        { 
          'data': 'band',
          'name': 'band__name',
          'width': '10rem',
          'render': function (data, type, row, meta) {
            if (type === 'display') {
              return '<a href="/bands/' + data.id + '">'+ data.name +'</a>';
            } else if (type == 'filter') {
              return 'band__name';
            };
          },
        },
        { 
          'data': 'first.date',
          'name': 'first__id, first__early_late',
          'width': '6rem',
          'render': function (data, type, row, meta) {
            if (type === 'display') {
              return '<a href="/events/' + data.id + '">'+ data.display +'</a>';
            }
          },          
        },
        { 
          'data': 'last.date',
          'name': 'last__id, last__early_late',
          'width': '6rem',
          'render': function (data, type, row, meta) {
            if (type === 'display') {
              return '<a href="/events/' + data.id + '">'+ data.display +'</a>';
            }
          },          
        },
        { 'data': 'num_shows', 'name': 'num_shows', 'width': '1rem' },
        { 'data': 'num_songs', 'name': 'num_songs', 'width': '1rem'  },
        { 'data': 'num_legs', 'name': 'num_legs', 'width': '1rem'  },
      ]
    });
  });
  </script>
{% endblock scripts %}

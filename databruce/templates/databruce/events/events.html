{% extends "databruce/base.html" %}
{% block title %}
  Events
{% endblock title %}
{% block content %}
  <div class="col-12 col-xxl-8 mx-auto">
    <div class="d-flex justify-content-between mb-3">
      <div class="text-2xl">Events</div>
      <div class="float-end" id="year-select">
        <button class="btn btn-sm btn-primary dropdown-toggle"
                type="button"
                data-bs-toggle="dropdown"
                aria-expanded="false">{{ year }}</button>
        <ul class="dropdown-menu">
          {% for i in years %}
            <li>
              <a class="dropdown-item" href="{% url "events_year" year=i %}">{{ i }}</a>
            </li>
          {% endfor %}
        </ul>
      </div>
    </div>
    <div class="card">
      <div class="card-body px-0">
        <div class="table-responsive">
          <table class="table table-hover display" id="eventTable">
            <thead>
              <tr class="custom">
                <th class="all" scope="col">Date</th>
                <th class="min-tablet-l icon text-center text-nowrap align-middle d-none d-md-block"
                    scope="col">
                  <i class="bi bi-file-earmark-check d-none d-md-block"
                     data-bs-toggle="tooltip"
                     data-bs-placement="top"
                     data-bs-title="Has Setlist">
                  </i>
                  <span class="d-inline d-md-none">Setlist:</span>
                </th>
                <th class="min-tablet-l" scope="col">Band</th>
                <th class="min-tablet-l" scope="col">Venue</th>
                <th class="min-tablet-l" scope="col">Location</th>
                <th class="min-tablet-l" scope="col">Tour</th>
                <th class="min-tablet-l" scope="col">Detail</th>
                <th class="min-tablet-l" scope="col">Public</th>
              </tr>
            </thead>
            <tbody>
              {% for event in event_info %}
                <tr>
                  <td scope="row"
                      class="text-nowrap"
                      data-sort="{{ event.get_date }}"
                      data-filter="{{ event.get_date }}">
                    <a href="{% url "event_details" id=event.id %}">{{ event.get_date }}</a>
                  </td>
                  <td class="icon text-center align-middle">
                    {% if event.setlist_certainty == "Confirmed" %}
                      <i class="bi bi-file-earmark-check d-none d-md-block"
                         data-bs-toggle="tooltip"
                         data-bs-placement="top"
                         data-bs-title="Has Setlist"></i>
                      <div class="d-inline d-md-none">True</div>
                    {% else %}
                      <div class="d-inline d-md-none">False</div>
                    {% endif %}
                  </td>
                  <td class="text-nowrap">
                    <a href="{% url "band_details" id=event.artist.id %}">{{ event.artist.name }}</a>
                  </td>
                  <td class="text-nowrap">
                    <a href="{% url "venue_details" id=event.venue.id %}">{{ event.venue.get_name }}</a>
                  </td>
                  <td class="text-nowrap">
                    {% if event.venue.city %}
                      <a href="{% url "city_details" id=event.venue.city.id %}">{{ event.venue.city|default_if_none:"" }}</a>
                    {% endif %}
                  </td>
                  <td class="text-nowrap">
                    <a href="{% url "tour_details" id=event.tour.id %}">{{ event.tour.name|default_if_none:"" }}</a>
                  </td>
                  <td class="text-nowrap">{{ event.title|default_if_none:""|safe }}</td>
                  <td>{{ event.public|default_if_none:"" }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
  <script>
  $(document).ready(function () {
    new DataTable('#eventTable', {
      layout: getDatatableLayout([1,2,3,4]),
      columnDefs: [
        { targets: [1], orderable: false },
        { targets: [0], type: 'date' },
        { targets: [-1], visible: false },
      ],
      initComplete: function () {
        categorySelect('Category', [{'label': 'All', 'value': '.*'}, {'label': 'Public', 'value': 'True'}, {'label': 'Private', 'value': 'False'}]);

        this.api()
          .columns([-1])
          .every(function () {
            categorySearch(this);
          });
      },
    });

    $(function(){
      // bind change event to select
      $('#year_select').on('change', function () {
          var url = $(this).val() // get selected value
          console.log(url);
          if (url) { // require a URL
              window.location = url; // redirect
          }
          return false;
      });
    });
  });
  </script>
{% endblock content %}

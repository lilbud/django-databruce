{% extends "databruce/base.html" %}
{% block title %}
  Home
{% endblock title %}
{% load static %}
{% block content %}
  {% regroup events by artist as events_list %}
  <div class="row mb-4">
    <div class="col">
      <h1>Welcome to Databruce</h1>
    </div>
  </div>
  <div class="row mb-4">
    <div class="col-lg-6">
      <div class="card mb-4">
        <img class="img-fluid object-fit-cover rounded"
             id="headimg"
             src="{% static 'databruce/img/header.jpg' %}"
             alt=""
             height="auto"
             width="auto">
      </div>
    </div>
    <div class="col-lg-6">
      <div class="row row-cols-1 row-cols-md-1 g-4 mb-4">
        <div class="col">
          <div class="card h-100">
            <h4 class="card-header">Recent Events</h4>
            <div class="card-body p-0">
              <div class="table-responsive p-0 index">
                <table class="table table display" id="recentTable">
                  <thead>
                    <tr>
                      <th class="all">Date</th>
                      <th class="all">Location</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for event in recent %}
                      <tr>
                        <td class="text-nowrap">
                          <a href="{% url 'databruce:event_details' event=event.id %}">{{ event }}</a>
                        </td>
                        <td class="text-wrap">
                          <a href="{% url "databruce:venue_details" id=event.venue.id %}">
                            {% if event.venue.city %}
                              {{ event.venue }}, {{ event.venue.city }}
                            {% else %}
                              {{ event.venue }}
                            {% endif %}
                          </a>
                        </td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        <div class="col">
          <div class="card h-100">
            <h4 class="card-header">Upcoming Events</h4>
            <div class="card-body p-0">
              <div class="table-responsive p-0 index">
                <table class="table table display" id="upcomingTable">
                  <thead>
                    <tr>
                      <th class="all">Date</th>
                      <th class="all">Location</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for event in upcoming %}
                      <tr>
                        <td class="text-nowrap">
                          <a href="{% url 'databruce:event_details' event=event.id %}">{{ event }}</a>
                        </td>
                        <td class="text-wrap">
                          <a href="{% url "databruce:venue_details" id=event.venue.id %}">
                            {% if event.venue.city %}
                              {{ event.venue }}, {{ event.venue.city }}
                            {% else %}
                              {{ event.venue }}
                            {% endif %}
                          </a>
                        </td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        <div class="col">
          <div class="card h-100">
            <h4 class="card-header">
              On This Day ({{ date|date:"F d" }})
              <a href="{% url 'databruce:adv_search' %}?current=true">see more</a>
            </h4>
            <div class="card-body p-0">
              <div class="table-responsive p-0 index">
                <table class="table table display" id="otdTable">
                  <thead>
                    <tr>
                      <th class="all">Date</th>
                      <th class="all">Location</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for event in events %}
                      <tr>
                        <td class="text-nowrap">
                          <a href="{% url 'databruce:event_details' event=event.id %}">{{ event }}</a>
                        </td>
                        <td class="text-wrap">
                          <a href="{% url "databruce:venue_details" id=event.venue.id %}">
                            {% if event.venue.city %}
                              {{ event.venue }}, {{ event.venue.city }}
                            {% else %}
                              {{ event.venue }}
                            {% endif %}
                          </a>
                        </td>
                      </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <script>
    // removes searchBuilder button, not needed for this.
    layout.topEnd.features[1].buttons.pop()
    
    $(document).ready(function () {
      $('table.display').dataTable({
        columnDefs: [
        {'width': '200px', 'target': 0}
        ],
        searching: false,
        ordering: false,
        info: false,
        paging: false,
      })
    })
  </script>
{% endblock content %}
